<!DOCTYPE html>
<html>
    <head>
        <script src="https://polyfill.io/v3/polyfill.min.js?features=default"></script>
        <script type='text/javascript' src='knockout-3.5.1.js'></script>
        <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>

        <style>
            .center {
            display: block;
            margin-left: auto;
            margin-right: auto;
            height: 100px            ;
            width: 100px;
            object-fit: cover;
            }

            .container{

                width: 100%;
                height: 300px;
            }

            .rv-card{

                display: inline-block;
                width:150px;

            }

            .rvname{
                white-space: nowrap;
                overflow: hidden;
                text-overflow: ellipsis;
                width: 150px;
                display: flow-root;
            }
        </style>

        <script type="text/javascript">

// Create the script tag, set the appropriate attributes
var script = document.createElement('script');
script.src = 'https://maps.googleapis.com/maps/api/js?key=AIzaSyDVHYFCCuN4E5kc292Z1Sub1P5HHpm72eE&callback=initMap';
script.async = true;

let map;
// Attach your callback function to the `window` object
window.initMap = async function() {
  //@ts-ignore
  const { Map } = await google.maps.importLibrary("maps");

  map = new Map(document.getElementById("map"), {
    center: { lat: 49.283356, lng: -123.122115 },
    zoom: 12,
  });
};

// Append the 'script' element to 'head'
document.head.appendChild(script);
        </script>
    </head>

    <body >

        <!-- <p>First name: <input data-bind="value: firstName" /></p>
        <p>Last name: <input data-bind="value: lastName" /></p> -->

        <div id="map" class="container"></div>

        <input type="button" data-bind="click: searchRv" value="Search" />


        <div data-bind="foreach: featuredRVs, visible: featuredRVs().length > 0" >
            <div class="rv-card">
                <label data-bind="text: RVName" class="rvname"></label><br />
                <div style="width:150px;height:150px;display:inline-block;">
                    <img class="center" data-bind="attr:{src: 'https://cdn-d.rvezy.com/450x300x80' +  Photos[0].Path}" />  
                </div>

            </div>

        </div>



<script type="text/javascript">

    function AppViewModel() {
        // this.firstName = ko.observable("Bert");
        // this.lastName = ko.observable("Bertington");

        this.featuredRVs = ko.observableArray([]);

        this.searchRv = async function(){
            try {
                this.isLoadingData = true
                const response = await axios.get(`https://api.rvezy.com/api/rvlistings/unified-search?swLat=49.278657566566835&swLng=-123.14434518428638&neLat=49.29366175327391&neLng=-123.10486306758716&SortOrder=Recommended&CurrentPage=0&FeaturedCurrentPage=0&FeaturedPageSize=5&IncludeFeatured=true`);
                const FeaturedRVs = response?.data?.FeaturedRVs?.ListRVs
                const PopularRVs = response?.data?.PopularRVs?.ListRVs

                this.featuredRVs.removeAll();
                
                FeaturedRVs.forEach(function(rv){
                    //rv.RVName = ko.observable(rv.RVName);
                    rv.Photos[0].Path = rv.Photos[0].Path.replace('.jpg', '.webp');
//p.replace('dog', 'monkey')
                    this.featuredRVs.push(rv);


                }, this);
                
                console.log('response', response);
            } catch (error) {
                console.log(error);
            } finally
            {
                this.isLoadingData = false
            }
        }
    }
    
    // Activates knockout.js
    ko.applyBindings(new AppViewModel());
</script>

    </body>
</html>